<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTSP Camera Viewer</title>
    
    <!-- Bulma CSS (local) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bulma.min.css') }}">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Header -->
    <section class="hero is-dark is-small">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    üìπ RTSP Camera Viewer
                </h1>
                <p class="subtitle">
                    Live camera monitoring dashboard
                </p>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <section class="section">
        <div class="container">
            <div class="columns is-multiline">
                {% for camera in cameras %}
                <div class="column is-one-third">
                    <div class="box camera-box">
                        <!-- Camera Header -->
                        <div class="camera-header">
                            <div class="level is-mobile">
                                <div class="level-left">
                                    <div class="level-item">
                                        <h3 class="title is-5">
                                            üì∑ {{ camera.name }}
                                        </h3>
                                    </div>
                                </div>
                                <div class="level-right">
                                    <div class="level-item">
                                        <div class="field has-addons">
                                            <p class="control">
                                                <button class="button is-small quality-btn active"
                                                        data-camera="{{ camera.id }}"
                                                        data-quality="main"
                                                        title="High Quality (ch0)">
                                                    <span>‚óè</span>
                                                    <span>HD</span>
                                                </button>
                                            </p>
                                            <p class="control">
                                                <button class="button is-small quality-btn"
                                                        data-camera="{{ camera.id }}"
                                                        data-quality="sub"
                                                        title="Lower Quality (ch1)">
                                                    <span>‚óè</span>
                                                    <span>SD</span>
                                                </button>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="level-item">
                                        <!-- Motion detection toggle -->
                                        <button class="button is-small motion-toggle-btn"
                                                id="motion-toggle-{{ camera.id }}"
                                                data-camera="{{ camera.id }}"
                                                title="Toggle Motion Detection">
                                            <span class="icon">
                                                <span class="motion-icon">üëÅÔ∏è</span>
                                            </span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Camera Stream Container -->
                        <div class="camera-container" id="container-{{ camera.id }}">
                            {% if camera.url %}
                            <!-- Stream Image -->
                            <img class="camera-stream" 
                                 id="stream-{{ camera.id }}"
                                 src="{{ url_for('video_feed', camera_id=camera.id, quality='main') }}"
                                 alt="{{ camera.name }}">
                            
                            <!-- TV Static Canvas (hidden by default) -->
                            <canvas class="tv-static" 
                                    id="static-{{ camera.id }}"
                                    width="640" 
                                    height="480"
                                    style="display: none;"></canvas>
                            
                            <!-- Reconnection Indicator -->
                            <div class="reconnecting-overlay" 
                                 id="reconnecting-{{ camera.id }}"
                                 style="display: none;">
                                <div class="notification is-warning">
                                    <span class="spin-icon">‚ü≥</span>
                                    <span>Reconnecting...</span>
                                </div>
                            </div>
                            {% else %}
                            <!-- No Camera Configured -->
                            <div class="notification is-info">
                                <p><strong>Camera not configured</strong></p>
                                <p class="is-size-7">Add CAM_{{ camera.id }} to your .env file</p>
                            </div>
                            {% endif %}
                        </div>

                        <!-- Camera Footer / Status -->
                        <div class="camera-footer">
                            <div class="tags">
                                <span class="tag is-success is-light" id="status-{{ camera.id }}">
                                    <span>‚óè Live</span>
                                </span>
                                <span class="tag is-light" id="quality-tag-{{ camera.id }}">
                                    Main Stream (ch0)
                                </span>
                                <!-- Motion detection status badge -->
                                <span class="tag motion-status-badge"
                                      id="motion-status-{{ camera.id }}"
                                      style="display: none;">
                                    <span class="motion-pulse">‚óè</span>
                                    <span>Motion</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Info Box -->
            <div class="notification is-info is-light">
                <p><strong>Tips:</strong></p>
                <ul>
                    <li>Toggle between <strong>HD</strong> (main/ch0) and <strong>SD</strong> (sub/ch1) streams to manage bandwidth</li>
                    <li>Click the üëÅÔ∏è button to enable motion detection with visual overlays</li>
                    <li>Streams automatically reconnect if connection is lost</li>
                    <li>TV static appears when camera is offline or unreachable</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="content has-text-centered">
            <p>
                <strong>RTSP Camera Viewer</strong> - Monitor your cameras in real-time
            </p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
